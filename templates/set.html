{% extends "base.html" %}

{% block content %}

<h1>{{ set.title }}</h1>

<div class="set-tags">
    <strong>Tags:</strong>
    {% for tag in set.tags | sort(case_sensitive=False) %}
        <span class="tag-item">
            <a href="{{ url_for('view_tag', tag_name=tag) }}" class="tag-button">
                {{ tag }}
            </a>

            <form method="POST"
                  action="{{ url_for('remove_tag', slug=set.slug) }}"
                  class="remove-form">
                <input type="hidden" name="tag_to_remove" value="{{ tag }}">
                <button type="submit" class="remove-btn">&times;</button>
            </form>
        </span>
        {% if not loop.last %} {% endif %}
    {% endfor %}

    <button type="button" id="add-tag-button">Add Tag</button>

    <form method="POST"
          action="{{ url_for('add_tag', slug=set.slug) }}"
          id="add-tag-form"
          style="display:none;">
        <input type="text" name="new_tag" placeholder="Enter Tag" required>
        <button type="submit">Save</button>
    </form>
</div>

<div class="set-people">
    <strong>People:</strong>
    {% for person in set.people | sort(case_sensitive=False) %}
        <span class="person-item">
            <a href="{{ url_for('view_person', person_name=person) }}" class="people-button">
                {{ person }}
            </a>

            <form method="POST"
                  action="{{ url_for('remove_person', slug=set.slug) }}"
                  class="remove-form">
                <input type="hidden" name="person_to_remove" value="{{ person }}">
                <button type="submit" class="remove-btn">&times;</button>
            </form>
        </span>
        {% if not loop.last %} {% endif %}
    {% endfor %}

    <button type="button" id="add-person-button">Add Person</button>

    <form method="POST"
          action="{{ url_for('add_person', slug=set.slug) }}"
          id="add-person-form"
          style="display:none;">
        <input type="text" name="new_person" placeholder="Enter Name" required>
        <button type="submit">Save</button>
    </form>
</div>

<div class="images-grid">
    {% for image in set.images %}
        {% set basename = image.rsplit('.', 1)[0] %}
        <img
            src="{{ url_for('static', filename='sets/' ~ set.slug ~ '/thumbnails/' ~ basename ~ '_thumb_400.jpg') }}"
            data-src="{{ url_for('static', filename='sets/' ~ set.slug ~ '/' ~ image) }}"
            data-thumb="{{ url_for('static', filename='sets/' ~ set.slug ~ '/thumbnails/' ~ basename ~ '_thumb_150.jpg') }}"
            loading="lazy"
            class="gallery-image"
            data-index="{{ loop.index0 }}"
            onclick="openLightbox({{ loop.index0 }})"
        >
    {% endfor %}
</div>

<div id="lightbox" class="lightbox" style="display: none;">
    <span class="lightbox-close">&times;</span>

    <!-- Top bar: counter, fullscreen, download -->
    <div class="lightbox-toolbar">
        <span id="lightbox-counter" class="lightbox-counter"></span>
        <button id="lightbox-fullscreen" class="lightbox-toolbar-btn" title="Fullscreen">&#x26F6;</button>
        <a id="lightbox-download" class="lightbox-toolbar-btn" title="Download" download>&#8659;</a>
    </div>

    <img id="lightbox-image" src="" alt="">

    <div class="lightbox-nav lightbox-prev">&#10094;</div>
    <div class="lightbox-nav lightbox-next">&#10095;</div>

    <!-- Thumbnail strip -->
    <div id="lightbox-thumbnails" class="lightbox-thumbnails"></div>
</div>

<script src="{{ url_for('static', filename='js/gallery.js') }}"></script>

{% endblock %}