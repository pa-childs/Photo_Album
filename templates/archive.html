{% extends "base.html" %}

{% block content %}

{% if not filter_type %}
    <div class="archive-sort">
        <div class="archive-filter-box">
            <label for="archive-search">Search:</label>
            <input type="text" id="archive-search">
        </div>

        {% if art_section %}
        <div class="mode-switcher">
            <select onchange="window.location.href=this.value">
                <option value="{{ url_for('archive', mode='art') }}" {% if mode == 'art' %}selected{% endif %}>
                    Art
                </option>
                <option value="{{ url_for('archive') }}" {% if mode == 'photo' %}selected{% endif %}>
                    Photography
                </option>
            </select>
        </div>
        {% endif %}
    </div>

    {% if mode != "art" %}
        <div class="archive-sort-links">
            Sort:
            <a href="{{ url_for('archive') }}">Most Recent</a> |
            <a href="{{ url_for('archive', sort='images') }}">Image Count</a> |
            <a href="{{ url_for('archive', sort='random') }}">Random</a>
        </div>
    {% endif %}

{% endif %}

{% if filter_type %}
    <div class="archive-filter">
        <span class="filter-label">Filtered By:</span>
        <span class="tag-button filter-pill">
            {{ filter_value }}
        </span>
    </div>
{% endif %}

{% if mode == "art" and grouped_art %}
    {% for series_name, issues in grouped_art.items() %}
        <div class="series-group">
            <h2 class="series-title">{{ series_name }}</h2>
            <div class="sets-grid">
                {% for set in issues %}
                    <a href="/set/{{ set.slug }}" class="set-card" data-tags="{{ set.tags | join(',') | lower }}" data-people="{{ set.people | join(',') | lower }}">
                        {% if set.cover %}
                            <div class="set-image">
                                <img src="{{ url_for('static', filename='sets/' ~ set.slug ~ '/' ~ set.cover) }}">
                            </div>
                        {% endif %}
                        <div class="set-info">
                            <div class="set-info-header">
                                <h2>{{ set.title }}</h2>
                                <div class="image-count-badge">
                                    {{ set.image_count }} Images
                                </div>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            </div>
        </div>
    {% endfor %}

{% else %}
    <div class="sets-grid">
        {% for set in sets %}
            <a href="/set/{{ set.slug }}" class="set-card" data-tags="{{ set.tags | join(',') | lower }}" data-people="{{ set.people | join(',') | lower }}">
                {% if set.cover %}
                    <div class="set-image">
                        <img src="{{ url_for('static', filename='sets/' ~ set.slug ~ '/' ~ set.cover) }}">
                    </div>
                {% endif %}
                <div class="set-info">
                    <div class="set-info-header">
                        <h2>{{ set.title }}</h2>
                        <div class="image-count-badge">
                            {{ set.image_count }} Images
                        </div>
                    </div>
                </div>
            </a>
        {% endfor %}
    </div>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("archive-search");
    if (!searchInput) return;

    searchInput.addEventListener("input", function () {
        const searchTerm = searchInput.value.toLowerCase();

        {% if mode == "art" %}
            const seriesGroups = document.querySelectorAll(".series-group");

            seriesGroups.forEach(function (seriesGroup) {
                const setCards = seriesGroup.querySelectorAll(".set-card");
                let visibleCount = 0;

                setCards.forEach(function (setCard) {
                    const title = setCard.querySelector("h2").textContent.toLowerCase();
                    const seriesTitle = seriesGroup.querySelector(".series-title").textContent.toLowerCase();
                    const tags = setCard.dataset.tags || "";
                    const people = setCard.dataset.people || "";

                    if (title.includes(searchTerm) || seriesTitle.includes(searchTerm) || tags.includes(searchTerm) || people.includes(searchTerm)) {
                        setCard.style.display = "";
                        visibleCount++;
                    } else {
                        setCard.style.display = "none";
                    }
                });

                seriesGroup.style.display = visibleCount === 0 ? "none" : "";
            });

        {% else %}
            const setCards = document.querySelectorAll(".set-card");

            setCards.forEach(function (setCard) {
                const title = setCard.querySelector("h2").textContent.toLowerCase();
                const tags = setCard.dataset.tags || "";
                const people = setCard.dataset.people || "";

                if (title.includes(searchTerm) || tags.includes(searchTerm) || people.includes(searchTerm)) {
                    setCard.style.display = "";
                } else {
                    setCard.style.display = "none";
                }
            });
        {% endif %}
    });
});
</script>

{% endblock %}